version: "3.8"
services:
  # TimescaleDB service - runs in Docker
  timescaledb:
    image: timescale/timescaledb:latest-pg17
    container_name: mt5-timescaledb
    ports:
      - "25432:5432"
    environment:
      - POSTGRES_DB=mt5_orderbook
      - POSTGRES_USER=mt5_user
      - POSTGRES_PASSWORD=mt5_password
    volumes:
      - timescaledb_data:/var/lib/postgresql/data
    restart: unless-stopped
    command: ["postgres", "-c", "shared_preload_libraries=timescaledb"]

  # MT5 Loader service - runs natively on Windows host
  # This service definition is for documentation purposes only
  # The actual loader should be run directly on Windows
  # mt5-loader:
  #   build: .
  #   image: mt5-orderbook-loader:latest
  #   environment:
  #     SYMBOL: ${SYMBOL}
  #     TIMEZONE: ${TIMEZONE}
  #     INFLUX_URL: http://host.docker.internal:8086
  #     INFLUX_TOKEN: ${INFLUX_TOKEN}
  #     INFLUX_ORG: ${INFLUX_ORG}
  #     INFLUX_BUCKET: ${INFLUX_BUCKET}
  #     POLL_INTERVAL_MS: ${POLL_INTERVAL_MS}
  #     WRITE_BATCH_SIZE: ${WRITE_BATCH_SIZE}
  #     WRITE_FLUSH_INTERVAL_MS: ${WRITE_FLUSH_INTERVAL_MS}
  #     MT5_TERMINAL_PATH: ${MT5_TERMINAL_PATH}
  #     MT5_LOGIN: ${MT5_LOGIN}
  #     MT5_PASSWORD: ${MT5_PASSWORD}
  #     MT5_SERVER: ${MT5_SERVER}
  #   env_file:
  #     - .env
  #   # Note: This service cannot run in Docker due to MT5 requirements
  #   # Use the run-windows.ps1 script instead
  #   profiles: ["do-not-use"]

volumes:
  timescaledb_data:
